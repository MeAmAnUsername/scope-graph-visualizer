<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
  </head>
  <body>
    <!-- Create a div where the graph will take place -->
    <div id="scope-graph-svg"></div>

    <script>

    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 30, bottom: 30, left: 40},
      width = 1080 - margin.left - margin.right,  // width of svg
      height = 720 - margin.top - margin.bottom, // height of svg
      radius = 15,                               // radius
      edgeLabelPlacement = .4;                   // placement of the label along the length of the edge (0 to 1). Measured from the _centers_ of the nodes

    // append the svg object to the body of the page
    var svg = d3.select('#scope-graph-svg')
    .append('svg')
      .attr('width', width + margin.left + margin.right)
      .attr('height', height + margin.top + margin.bottom)
    .append('g')
      .attr('transform',
            `translate(${margin.left},${margin.top})`);

    svg.append('defs').append('marker')
      .attr('id', 'arrowhead')
      .attr('viewBox', '-0 -5 10 10')
      .attr('refX', 5 + radius)
      .attr('refY', 0)
      .attr('orient', 'auto')
      .attr('markerWidth', 13)
      .attr('markerHeight', 13)
      .attr('xoverflow', 'visible')
      .append('svg:path')
      .attr('d', 'M 0,-5 L 10 ,0 L 0,5')
      .attr('fill', '#999')
      .style('stroke','none');


    function createGraph(data) {

      // Initialize the links
      var link = svg
        .selectAll('.link')
        .data(data.links)
        .enter()
        .append('g')
          .attr('class', 'link')

      var linkLine = link.append('line')
          .attr('marker-end','url(#arrowhead)')
          .style('stroke', '#aaa')

      var linkLabel = link.append('text')
        .attr('text-anchor', 'middle')
        .attr('alignment-baseline', 'middle')
        .attr('class', 'edgelabel')
        .attr('font-size', 10)
        .attr('fill', '#555555')
        .text(d => d.label)

      // Initialize the nodes
      var node = svg
        .selectAll('.node')
        .data(data.nodes)
        .enter()
        .append('g')
          .attr('class', 'node')


      node.append('circle')
        .attr('cx', 0)
        .attr('cy', 0)
        .attr('r', radius)
        .style('stroke', '#69b3a2')
        .style('fill', '#ffffff')
      
      node.append('text')
        .attr('text-anchor', 'middle')
        .attr('alignment-baseline', 'middle')
        .text(d => d.label)


      // Let's list the force we wanna apply on the network
      var simulation = d3.forceSimulation(data.nodes)                 // Force algorithm is applied to data.nodes
          .force('.link', d3.forceLink()                               // This force provides links between nodes
                .id(d => d.id)                                        // This provide  the id of a node
                .links(data.links)                                    // and this the list of links
          )
          .force('charge', d3.forceManyBody().strength(-2000))         // This adds repulsion between nodes. Play with the -400 for the repulsion strength
          .force('center', d3.forceCenter(width / 2, height / 2))     // This force attracts nodes to the center of the svg area
          .on('end', ticked);

      // This function is run at each iteration of the force algorithm, updating the nodes position.
      function ticked() {
        linkLine
          .attr('x1', d => d.source.x)
          .attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x)
          .attr('y2', d => d.target.y);

        linkLabel
          .attr('x', d => d.source.x * (1-edgeLabelPlacement) + d.target.x * edgeLabelPlacement)
          .attr('y', d => d.source.y * (1-edgeLabelPlacement) + d.target.y * edgeLabelPlacement)
        
        node
          .attr('transform', d => `translate(${d.x}, ${d.y})`)
      }

    }

    function scopeToLabel(scope) {
      const matchResult = scope.id.match(/^#[^-]*-([^-]+)-[0-9]+$/);
      if (matchResult === null) {
        console.warn("scope id did not match regex: ", scope.id, scope)
        return scope.id;
      }
      return matchResult[1];
    }

    const data = {
      "nodes": [
        {"id": "#.-s_mod_tree_28-7"},
        {"id": "#src/main/test.pie-s_mod_2-14"},
        {"id": "#-s_1-1"},
        {"id": "#.-s_mod_tree_26-11"},
        {"id": "#src/main/test.pie-s_data_def_6-9"},
        {"id": "#src/main/test.pie-s_tree_root_61-17"},
        {"id": "#.-s_tree_root_24-14"}
      ], "links": [
        {"source": "#.-s_mod_tree_28-7", "target": "#src/main/test.pie-s_mod_2-14", "label": "FILE"},
        {"source": "#src/main/test.pie-s_mod_2-14", "target": "#src/main/test.pie-s_tree_root_61-17", "label": "MODULE_TREE_ROOT"},
        {"source": "#src/main/test.pie-s_mod_2-14", "target": "#-s_1-1", "label": "P"},
        {"source": "#-s_1-1", "target": "#.-s_tree_root_24-14", "label": "MODULE_TREE_ROOT"}
      ]
    }
    
    data.nodes = data.nodes.map(node => ({...node, label: scopeToLabel(node)}))
    createGraph(data);

    </script>
  </body>
</html>
