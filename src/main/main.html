<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
  </head>
  <body>
    <!-- Create a div where the graph will take place -->
    <div id="scope-graph-svg"></div>

    <script>

    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 30, bottom: 30, left: 40},
      width = 1080 - margin.left - margin.right,  // width of svg
      height = 720 - margin.top - margin.bottom, // height of svg
      radius = 10,                               // radius
      edgeLabelPlacement = .4;                   // placement of the label along the length of the edge (0 to 1). Measured from the _centers_ of the nodes

    // append the svg object to the body of the page
    var svg = d3.select('#scope-graph-svg')
    .append('svg')
      .attr('width', width + margin.left + margin.right)
      .attr('height', height + margin.top + margin.bottom)
    .append('g')
      .attr('transform',
            `translate(${margin.left},${margin.top})`);

    svg.append('defs').append('marker')
      .attr('id', 'arrowhead')
      .attr('viewBox', '-0 -5 10 10')
      .attr('refX', 5 + radius)
      .attr('refY', 0)
      .attr('orient', 'auto')
      .attr('markerWidth', 13)
      .attr('markerHeight', 13)
      .attr('xoverflow', 'visible')
      .append('svg:path')
      .attr('d', 'M 0,-5 L 10 ,0 L 0,5')
      .attr('fill', '#999')
      .style('stroke','none');


    function createGraph(data) {

      // Initialize the links
      var link = svg
        .selectAll('.link')
        .data(data.links)
        .enter()
        .append('g')
          .attr('class', 'link')

      var linkLine = link.append('line')
          .attr('marker-end','url(#arrowhead)')
          .style('stroke', '#aaa')

      var linkLabel = link.append('text')
        .attr('text-anchor', 'middle')
        .attr('alignment-baseline', 'middle')
        .attr('class', 'edgelabel')
        .attr('font-size', 10)
        .attr('fill', '#555555')
        .text(d => d.label)

      // Initialize the nodes
      var node = svg
        .selectAll('.node')
        .data(data.nodes)
        .enter()
        .append('g')
          .attr('class', 'node')


      node.append('circle')
        .attr('cx', 0)
        .attr('cy', 0)
        .attr('r', radius)
        .style('stroke', '#69b3a2')
        .style('fill', '#ffffff')
      
      node.append('text')
        .attr('text-anchor', 'middle')
        .attr('alignment-baseline', 'middle')
        .attr('font-size', '12')
        .text(d => d.label)


      // Let's list the force we wanna apply on the network
      var simulation = d3.forceSimulation(data.nodes)
          .force('.link', d3.forceLink()
                .id(d => d.id)
                .distance(80)
                .strength(1)
                .links(data.links))
          .force('charge', d3.forceManyBody()
                .strength(-80)
                .distanceMin(5)
                .distanceMax(200))
          .force('center', d3.forceCenter(width / 2, height / 2))
          .on('end', ticked);

      // This function is run at each iteration of the force algorithm, updating the nodes position.
      function ticked() {
        linkLine
          .attr('x1', d => d.source.x)
          .attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x)
          .attr('y2', d => d.target.y);

        linkLabel
          .attr('x', d => d.source.x * (1-edgeLabelPlacement) + d.target.x * edgeLabelPlacement)
          .attr('y', d => d.source.y * (1-edgeLabelPlacement) + d.target.y * edgeLabelPlacement)
        
        node
          .attr('transform', d => `translate(${d.x}, ${d.y})`)
      }

    }

    function scopeToLabel(scope) {
      const matchResult = scope.id.match(/^#[^-]*-([^-]+)-[0-9]+$/);
      if (matchResult === null) {
        console.warn("scope id did not match regex: ", scope.id, scope)
        return scope.id;
      }
      return matchResult[1];
    }

    const data = {
      "nodes": [
        {"id": "#src/main/test.pie-s_data_def_501-68"},
        {"id": "#src/main/test.pie-s3_799-114"},
        {"id": "#.-s_data_instance_instantiated_1306-142"},
        {"id": "#.-s_merged_708-81"},
        {"id": "#.-s_merged_475-57"},
        {"id": "#src/main/test.pie-s_merged_464-51"},
        {"id": "#.-s_data_instance_234-38"},
        {"id": "#src/main/test.pie-s_merged_523-61"},
        {"id": "#src/main/test.pie-s_merged_738-98"},
        {"id": "#src/main/test.pie-s_merged_711-95"},
        {"id": "#.-s_data_instance_524-64"},
        {"id": "#.-s_merged_1154-126"},
        {"id": "#.-s_merged_1063-119"},
        {"id": "#.-s_data_instance_130-24"},
        {"id": "#.-s_data_instance_157-28"},
        {"id": "#.-s_data_instance_260-42"},
        {"id": "#.-s_data_instance_1218-137"},
        {"id": "#src/main/test.pie-s_data_def_100-19"},
        {"id": "#src/main/test.pie-s_merged_405-41"},
        {"id": "#.-s_data_instance_949-112"},
        {"id": "#.-s_merged_736-84"},
        {"id": "#.-s_merged_1035-116"},
        {"id": "#.-s_data_instance_1087-123"},
        {"id": "#src/main/test.pie-s_data_def_442-58"},
        {"id": "#src/main/test.pie-s_merged_860-113"},
        {"id": "#.-s_common_instance_1544-155"},
        {"id": "#.-s_data_instance_98-18"},
        {"id": "#src/main/test.pie-s_merged_654-88"},
        {"id": "#src/main/test.pie-s_func_50-7"},
        {"id": "#.-s_data_instance_584-72"},
        {"id": "#.-s_data_instance_instantiated_1413-150"},
        {"id": "#.-s_data_instance_instantiated_610-76"},
        {"id": "#src/main/test.pie-s_merged_672-90"},
        {"id": "#.-s_data_instance_instantiated_1596-159"},
        {"id": "#.-s_data_instance_286-46"},
        {"id": "#.-s_merged_913-104"},
        {"id": "#src/main/test.pie-s_block_28-103"},
        {"id": "#-s_1-1"},
        {"id": "#.-s_data_instance_799-97"},
        {"id": "#.-s_data_instance_772-92"},
        {"id": "#.-s_data_instance_instantiated_1379-146"},
        {"id": "#.-s_data_instance_instantiated_313-50"},
        {"id": "#.-s_data_instance_1192-133"},
        {"id": "#src/main/test.pie-s_func_inner_14-3"},
        {"id": "#src/main/test.pie-s_mod_2-81"},
        {"id": "#.-s_data_instance_923-108"},
        {"id": "#.-s_data_instance_instantiated_555-68"},
        {"id": "#src/main/test.pie-s_data_def_383-48"},
        {"id": "#.-s_data_instance_instantiated_1959-169"},
        {"id": "#.-s_data_instance_9-6"},
        {"id": "#.-s_data_instance_187-32"},
        {"id": "#.-s_data_instance_43-10"},
        {"id": "#.-s_data_instance_746-88"},
        {"id": "#src/main/test.pie-s_merged_122-10"},
        {"id": "#.-s_mod_tree_2025-174"},
        {"id": "#src/main/test.pie-s_merged_691-92"},
        {"id": "#src/main/test.pie-s_merged_636-86"},
        {"id": "#.-s_data_instance_71-14"},
        {"id": "#src/main/test.pie-s_merged_774-102"},
        {"id": "#.-s_merged_1182-129"},
        {"id": "#.-s_merged_514-60"},
        {"id": "#.-s_merged_885-101"},
        {"id": "#.-s_mod_tree_2023-178"},
        {"id": "#src/main/test.pie-s_data_def_222-30"},
        {"id": "#src/main/test.pie-s_data_def_560-76"},
        {"id": "#src/main/test.pie-s_tree_root_615-84"},
        {"id": "#.-s_tree_root_2021-181"},
        {"id": "#src/main/test.pie-s_data_def_348-38"},
        {"id": "#src/main/test.pie-s_empty_822-111"}
      ],
      "links": [
        {"source": "#src/main/test.pie-s_data_def_501-68", "target": "#.-s_data_instance_799-97", "label": "INHERIT"},
        {"source": "#src/main/test.pie-s3_799-114", "target": "#src/main/test.pie-s_block_28-103", "label": "P"},
        {"source": "#.-s_data_instance_instantiated_1306-142", "target": "#src/main/test.pie-s_data_def_222-30", "label": "P"},
        {"source": "#.-s_merged_708-81", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_merged_475-57", "target": "#src/main/test.pie-s3_799-114", "label": "P"},
        {"source": "#src/main/test.pie-s_merged_464-51", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_data_instance_234-38", "target": "#src/main/test.pie-s_data_def_560-76", "label": "P"},
        {"source": "#src/main/test.pie-s_merged_523-61", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#src/main/test.pie-s_merged_738-98", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#src/main/test.pie-s_merged_711-95", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_data_instance_524-64", "target": "#src/main/test.pie-s_data_def_560-76", "label": "P"},
        {"source": "#.-s_merged_1154-126", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_merged_1063-119", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_data_instance_130-24", "target": "#src/main/test.pie-s_data_def_222-30", "label": "P"},
        {"source": "#.-s_data_instance_157-28", "target": "#src/main/test.pie-s_data_def_560-76", "label": "P"},
        {"source": "#.-s_data_instance_260-42", "target": "#src/main/test.pie-s_data_def_383-48", "label": "P"},
        {"source": "#.-s_data_instance_1218-137", "target": "#src/main/test.pie-s_data_def_383-48", "label": "P"},
        {"source": "#src/main/test.pie-s_data_def_100-19", "target": "#.-s_data_instance_71-14", "label": "INHERIT"},
        {"source": "#src/main/test.pie-s_merged_405-41", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_data_instance_949-112", "target": "#src/main/test.pie-s_data_def_383-48", "label": "P"},
        {"source": "#.-s_merged_736-84", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_merged_1035-116", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_data_instance_1087-123", "target": "#src/main/test.pie-s_data_def_100-19", "label": "P"},
        {"source": "#src/main/test.pie-s_data_def_442-58", "target": "#.-s_data_instance_9-6", "label": "INHERIT"},
        {"source": "#src/main/test.pie-s_merged_860-113", "target": "#src/main/test.pie-s3_799-114", "label": "P"},
        {"source": "#.-s_common_instance_1544-155", "target": "#src/main/test.pie-s_data_def_222-30", "label": "P"},
        {"source": "#.-s_data_instance_98-18", "target": "#src/main/test.pie-s_data_def_560-76", "label": "P"},
        {"source": "#src/main/test.pie-s_merged_654-88", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#src/main/test.pie-s_func_50-7", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_data_instance_584-72", "target": "#src/main/test.pie-s_data_def_383-48", "label": "P"},
        {"source": "#.-s_data_instance_instantiated_1413-150", "target": "#src/main/test.pie-s_data_def_501-68", "label": "P"},
        {"source": "#.-s_data_instance_instantiated_610-76", "target": "#src/main/test.pie-s_data_def_383-48", "label": "P"},
        {"source": "#src/main/test.pie-s_merged_672-90", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_data_instance_instantiated_1596-159", "target": "#src/main/test.pie-s_data_def_222-30", "label": "P"},
        {"source": "#.-s_data_instance_286-46", "target": "#src/main/test.pie-s_data_def_222-30", "label": "P"},
        {"source": "#.-s_merged_913-104", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#src/main/test.pie-s_block_28-103", "target": "#src/main/test.pie-s_func_inner_14-3", "label": "P"},
        {"source": "#-s_1-1", "target": "#.-s_tree_root_2021-181", "label": "MODULE_TREE_ROOT"},
        {"source": "#.-s_data_instance_799-97", "target": "#src/main/test.pie-s_data_def_560-76", "label": "P"},
        {"source": "#.-s_data_instance_772-92", "target": "#src/main/test.pie-s_data_def_383-48", "label": "P"},
        {"source": "#.-s_data_instance_instantiated_1379-146", "target": "#src/main/test.pie-s_data_def_383-48", "label": "P"},
        {"source": "#.-s_data_instance_instantiated_313-50", "target": "#src/main/test.pie-s_data_def_222-30", "label": "P"},
        {"source": "#.-s_data_instance_1192-133", "target": "#src/main/test.pie-s_data_def_501-68", "label": "P"},
        {"source": "#src/main/test.pie-s_func_inner_14-3", "target": "#src/main/test.pie-s_func_50-7", "label": "P"},
        {"source": "#src/main/test.pie-s_mod_2-81", "target": "#-s_1-1", "label": "P"},
        {"source": "#src/main/test.pie-s_mod_2-81", "target": "#src/main/test.pie-s_tree_root_615-84", "label": "MODULE_TREE_ROOT"},
        {"source": "#.-s_data_instance_923-108", "target": "#src/main/test.pie-s_data_def_442-58", "label": "P"},
        {"source": "#.-s_data_instance_instantiated_555-68", "target": "#src/main/test.pie-s_data_def_560-76", "label": "P"},
        {"source": "#src/main/test.pie-s_data_def_383-48", "target": "#.-s_data_instance_157-28", "label": "INHERIT"},
        {"source": "#.-s_data_instance_instantiated_1959-169", "target": "#src/main/test.pie-s_data_def_560-76", "label": "P"},
        {"source": "#.-s_data_instance_9-6", "target": "#src/main/test.pie-s_data_def_560-76", "label": "P"},
        {"source": "#.-s_data_instance_187-32", "target": "#src/main/test.pie-s_data_def_222-30", "label": "P"},
        {"source": "#.-s_data_instance_43-10", "target": "#src/main/test.pie-s_data_def_501-68", "label": "P"},
        {"source": "#.-s_data_instance_746-88", "target": "#src/main/test.pie-s_data_def_560-76", "label": "P"},
        {"source": "#src/main/test.pie-s_merged_122-10", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_mod_tree_2025-174", "target": "#src/main/test.pie-s_mod_2-81", "label": "FILE"},
        {"source": "#src/main/test.pie-s_merged_691-92", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#src/main/test.pie-s_merged_636-86", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_data_instance_71-14", "target": "#src/main/test.pie-s_data_def_222-30", "label": "P"},
        {"source": "#src/main/test.pie-s_merged_774-102", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_merged_1182-129", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"},
        {"source": "#.-s_merged_514-60", "target": "#src/main/test.pie-s3_799-114", "label": "P"},
        {"source": "#.-s_merged_885-101", "target": "#src/main/test.pie-s_mod_2-81", "label": "P"}
      ]
    }
    
    data.nodes = data.nodes.map(node => ({...node, label: scopeToLabel(node)}))
    createGraph(data);

    </script>
  </body>
</html>
